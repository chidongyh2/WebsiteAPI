ko.components.register("comment-component",{viewModel:function(n){var t=this;t.objectId=n.objectId?n.objectId:-1;t.objectType=n.objectType!==null?n.objectType:-1;t.isShowTitle=n.isShowTitle?ko.observable(n.isShowTitle):ko.observable(!0);t.totalRows=ko.observable(0);t.pageSize=ko.observable(20);t.currentPage=ko.observable(1);t.totalPage=ko.observable(1);t.listPage=ko.observableArray([]);t.listComments=ko.observableArray([]);t.rendTree=function(n){_.each(n,function(n){n.state.show=ko.observable(!1);n.children&&n.children.length>0&&t.rendTree(n.children)})};t.getComment=function(n){t.currentPage(n);$.get("/get-comment",{objectId:t.objectId,objectType:t.objectType,page:t.currentPage(),pageSize:20},function(n){t.rendTree(n.items);t.totalRows(n.totalRows);t.renderPage(t.totalRows());t.listComments(n.items)})};t.postComment=function(){t.getComment(t.currentPage())};t.renderPage=function(n){if(t.totalRows(n),t.totalPage(Math.ceil(t.totalRows()/t.pageSize())),t.listPage([]),t.totalPage()>1)for(var i=1;i<=t.totalPage();i++)t.listPage.push({page:i})};t.searchPageIndex=function(n){t.currentPage(n.page);t.getComment(t.currentPage())};t.firstPage=function(){t.currentPage(1);t.getComment(1)};t.lastPage=function(){t.currentPage(t.totalPage());t.getComment(t.currentPage())};t.prevPage=function(){t.currentPage(t.currentPage()-1);t.getComment(t.currentPage())};t.nextPage=function(){t.currentPage(t.currentPage()+1);t.getComment(t.currentPage())};$(document).ready(function(){t.getComment(1)})},template:`<div class="comments">
    <!--ko if: isShowTitle() -->
    <div class="line"></div>
    <h3 class="title">Bình luận</h3>
    <!--/ko-->
    <comment-box-component params="objectId: objectId, objectType: objectType, postComment: postComment"></comment-box-component>
    <h2 class="comment-no">
               <b data-bind="text: totalRows()"></b>
                Bình luận.           
     </h2>
    <comment-list-component params="objectId: objectId, objectType: objectType, listComments: listComments, getComment: getComment"></comment-list-component>
    <!--ko if: totalPage() > 1-->
    <div class="row">
        <div class="col-sm-12 center" style="text-align:center">
            <ul class="pagination" data-bind="foreach: listPage()">
                <!--ko if: page === 1-->
                <li>
                    <a data-bind="css: $parent.currentPage() === 1 ? 'disabled' :  '', click: $parent.firstPage" href="#">
                        <i class="fa fa-angle-double-left"></i>
                    </a>
                </li>
                <li>
                    <a data-bind="css: $parent.currentPage() === 1 ? 'disabled bg-none' :  'bg-none', click: $parent.prevPage" href="#">
                        <i class="fa fa-angle-left"></i>
                    </a>
                </li>
                <!--/ko-->
                <li>
                    <a data-bind="css: $parent.currentPage() === page ? 'active' : '', text: page, click: $parent.searchPageIndex.bind($data)" href="#"></a>
                </li>
                <!--ko if: page === $parent.totalPage()-->
                <li>
                    <a data-bind="css: $parent.currentPage() === $parent.totalPage() ? 'disabled bg-none' : 'bg-none', click: $parent.nextPage" href="#">
                        <i class="fa fa-angle-right"></i>
                    </a>
                </li>
                <li>
                    <a data-bind="css: $parent.currentPage() === $parent.totalPage() ? 'disabled' : '', click: $parent.lastPage" href="#">
                        <i class="fa fa-angle-double-right"></i>
                    </a>
                </li>
                <!--/ko-->
            </ul>
        </div>
    </div>
    <!--/ko-->
</div>`});ko.components.register("comment-box-component",{viewModel:function(n){var t=this;t.objectId=n.objectId?n.objectId:-1;t.objectType=n.objectType!==null?n.objectType:-1;t.parentId=n.parentId?ko.observable(n.parentId):ko.observable(null);t.userId=n.userId?n.userId:ko.observable(null);t.userType=n.userType?n.userType:ko.observable(0);t.fullName=ko.observable();t.email=ko.observable();t.content=ko.observable();t.isSending=ko.observable(!1);t.save=function(){t.isSending(!0);var i={objectId:t.objectId,objectType:t.objectType,fullName:t.fullName(),email:t.email(),content:t.content(),parentId:t.parentId(),userId:t.userId(),userType:t.userType(),url:absoluteUri,__RequestVerificationToken:token};$.post("/comment",i,function(r){if(t.isSending(!1),r>0){t.fullName("");t.email("");t.content("");n.postComment instanceof Function&&(i.id=r,i.createTime=new Date,n.postComment(i));return}toastr.error(r)})};$(document).ready(function(){})},template:`<div class="box-comment">
       <form id="postComment" class="form-horizontal" data-bind="submit: save">
       <div class="row">
           <div class="col-sm-6">
               <div class="form-group">
                 <input class="form-control" data-bind="value: fullName" placeholder="Họ tên của bạn (bắt buộc)">
                </div>
            </div>
            <div class="col-sm-6">
                <div class="form-group">
                    <input class="form-control" data-bind="value: email" placeholder="Email của bạn"> 
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-12">
                 <div class="form-group">
                       <textarea class="form-control" data-bind="value: content" spellcheck="false" placeholder="Mời bạn nhập câu hỏi hoặc đánh giá (bắt buộc)."></textarea> 
                 </div>
            </div>
        </div>  
        <div class="row">
             <div class="col-sm-12">
                 <button type="submit" class="btn btn-send" data-bind="enable:!isSending()"> 
                     <i class="fa fa-spin fa-spinner" data-bind="visible:isSending()"style="display:none"></i>
                     Gửi bình luận
                  </button>
              </div>
        </div>      
       </form>       
</div>`});ko.components.register("comment-list-component",{viewModel:function(n){var t=this;t.objectId=n.objectId?n.objectId:-1;t.objectType=n.objectType!==null?n.objectType:-1;t.listComments=n.listComments?n.listComments:ko.observableArray([]);t.rendTree=function(n){_.each(n,function(n){n.state.show=ko.observable(!1);n.children&&n.children.length>0&&t.rendTree(n.children)})};t.postCommentChild=function(){n.getComment instanceof Function&&n.getComment()};$(document).ready(function(){})},template:`<div class="list-comment" data-bind="foreach: listComments">
    <div class="comment-item">
        <div class="media">
            <div class="media-left">
                <div class="avatar">
                    <img src="/images/no-avartar.jpg" class="img-circle" style="width:100%">
                </div>
                <div class="media-body">
                    <div class="content">
                        <p class="intro">
                            <strong class="name" data-bind="text: data.fullName "></strong>
                            <span data-bind="text: moment(data.createTime, 'DD/MM/YYYY').fromNow()"></span>
                        </p>
                        <div class="comment-details" data-bind="text: data.content ">
                        </div>
                        <p class="tools">
                            <a href="javascript:;" class="showComment" data-bind="click: function(data){ data.state.show(!data.state.show());}">
                            <span>Trả lời</span> <i class="fa fa-comments"></i> </a>                   
                        </p>
                         <!--ko if: state.show()-->                        
                         <comment-box-component params="objectId: $parent.objectId, objectType: $parent.objectType, parentId: id, postComment: $parent.postCommentChild"></comment-box-component>
                         <!--/ko-->
                         <!--ko if: childCount > 0-->
                               <div class="children">
                               <comment-list-component params="objectId: $parent.objectId, objectType: $parent.objectType, listComments: children"></comment-list-component> 
                               </div>
                         <!--/ko-->
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>`});